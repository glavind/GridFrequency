---
title: "Grid Frequency Analysis"
author: "Michael Bülow Pedersen"
output: pdf_document
---

## Research Objects

1. Download data from API and Web.
2. Store and handle a large dataset of $`r format(365*24*60*60+1,scientific=FALSE,big.mark = ",")`$ observations per year.
3. Handle timeseries data that cross daylight savings.
4. Create beautiful, informative graphs.
5. Produce reproducable research.
6. Make a shiny/rStudio presentation showing results.
7. Answer research questions:
    + is the frequency exactly 50 Hz on average?
    + what differences in frequency quality can be observed between the Nordic and Continental electricity grids?
    

## Introduction

The European electricity grid consists of several distinct frequency areas. One frequency area is the Nordic grid which covers Norway, Finland, Sweden and Eastern Denmark. Another frequency area is the Continental grid which covers countries such as Germany, France, Spain, Portugal, Italy, Slovenia, Czech Republic, Switzerland, Slovkia, Poland, and all the way to the border of Turkey...

To keep a power grid stable, it is necessary for the grid frequency to move within a narrow band around a predetermind value. 
For European countries the grid frequency has been set at reference frequency of 50 Hz+-1mHz. Whenever the frequency moves below this level, Transmission System Operators have contracted grid connected market participants to supply power to the grid at seconds notice. Similarly, if the frequency moves above 50 Hz TSO's have contracted participants to withdraw power from the grid. In the Continental grid extreme events are characterized by frequencies +- 100 mHz. Especially the low frequencies are critical because below -100 mHz all primary reserves have been exhausted and the grid cannot cope with additional loss off generation. Below -150 mHz there is a risk of power plants dropping out. On the other hand, at +200 mHz solar panels begin to risk dropping out..

Interestingly, it has also been agreed to run the power system at exactly 50 Hz on average. Because accumulated short-term frequency deviations can move the average above 50 Hz on one day, it is necessary to correct the grid frequency by setting a lower frequency point on subsequent days. We should therefore be able to observe autoregressive effects in the daily average frequency measurements.
Because of this correction, it should be possible to set a watch by measuring the grid frequency (give or take about a minute). 
We will test whether the information in this paragraph is indeed correct.

## Getting the data

### Nordic

We can query the API of the [Norwegian TSO Statnett](http://www.statnett.no/en/Market-and-operations/) to get 1 second measurements. This gives $`r format(365*24*60*60,scientific=FALSE,big.mark = ",")`$ observations per year.

The call to the API is http://driftsdata.statnett.no/restapi/Frequency/BySecond?FromInTicks=FromTimeInMs&ToInTicks=ToTimeInMs. The GET request returns 1 second measurements as well as startDate and EndDate of the request in Local timezone. The inputs are ms since epoch and therefore UTC.

Data retrieval is somewhat complicated by the fact that the return data does not have datetimes associated with each observation. This becomes a problem because there are missing observations. This happens for instance on 2015-01-07 15:33:00 to 15:34:00 (both seconds included). We are therefore forced to download an hour, check if it is complete. If not, get each minute and check if complete. If not, get each second and check if complete or finally NA.

The API only returns 1 hour of data (probably `r 60*60` observations). So,
```{r eval=F}
fromDate <- ymd_hms("2015-10-19 07:00:00")
toDate <- ymd_hms("2015-10-19 08:00:00")
```
gives data from "2015-10-19 09:00:00" to "2015-10-19 09:59:59"

### API Examples

The following examples illustrates how DST affects output

Before DST:
```{r eval=F}
fromDate <- dmy_hms("28-03-2015 12:00:00")
toDate <- dmy_hms("28-03-2015 13:00:00")
```
> "2015-03-28 13:00:00"  
> "2015-03-28 13:59:59"

After DST:
```{r eval=F}
fromDate <- dmy_hms("29-03-2015 12:00:00")
toDate <- dmy_hms("29-03-2015 13:00:00")
```
> "2015-03-29 14:00:00"  
> "2015-03-29 14:59:59"

Under DST (02:00-03:00 local time / 01:00-02:00 UTC does not exist):
```{r eval=F}
fromDate <- dmy_hms("29-03-2015 00:00:00")
toDate <- dmy_hms("29-03-2015 01:00:00")
```
> "2015-03-29 01:00:00"  
> "2015-03-29 01:59:59"

```{r eval=F}
fromDate <- dmy_hms("29-03-2015 00:30:00")
toDate <- dmy_hms("29-03-2015 01:30:00")
```
> "2015-03-29 01:30:00"  
> "2015-03-29 03:29:59"

```{r eval=F}
fromDate <- dmy_hms("29-03-2015 01:00:00")
toDate <- dmy_hms("29-03-2015 02:00:00")
```
> "2015-03-29 03:00:00"  
> "2015-03-29 03:59:59"



### Continental

We can query the Website of the [French TSO RTE](http://clients.rte-france.com/lang/an/clients_producteurs/vie/vie_frequence.jsp) to get 10 second measurements. This gives $`r format(365*24*60*60/10,scientific=FALSE,big.mark = ",")`$ observations per year.

The data is returned as a monthly zip file containing one csv file with 10 second measurements in Hz. The format of the date is currently unknown (UTC vs. Europe/Paris)
